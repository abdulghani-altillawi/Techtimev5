<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>منتجات الفئة الفرعية</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-900 text-gray-100 p-6">

  <button onclick="history.back()" class="mb-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">رجوع</button>
  <h1 id="subcategoryName" class="text-3xl font-bold mb-4 text-center"></h1>

  <div id="productsContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-6"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAPRUZs1HHbucnnOdqOr280TjLH86qETnA",
      authDomain: "techtimev3.firebaseapp.com",
      projectId: "techtimev3",
      storageBucket: "techtimev3.firebasestorage.app",
      messagingSenderId: "435597436729",
      appId: "1:435597436729:web:2bd440942a6c0da8fb6ae8",
      measurementId: "G-3984PMGWGH"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const urlParams = new URLSearchParams(window.location.search);
    const subcategoryId = urlParams.get("id");

    if (!subcategoryId) {
      document.body.innerHTML = "<p>لم يتم تحديد الفئة الفرعية.</p>";
    } else {
      db.collection("subcategories").doc(subcategoryId).get().then(subcatDoc => {
        if (!subcatDoc.exists) {
          document.body.innerHTML = "<p>الفئة الفرعية غير موجودة.</p>";
          return;
        }
        document.getElementById("subcategoryName").textContent = subcatDoc.data().name;

        // جلب المنتجات التي تحتوي على هذا subcategoryId
        db.collection("products").where("subcategory", "==", subcategoryId).get().then(prodSnap => {
          const container = document.getElementById("productsContainer");
          container.innerHTML = "";
          prodSnap.forEach(prodDoc => {
            const p = prodDoc.data();
            const id = prodDoc.id;
            container.innerHTML += `
              <div class="bg-gradient-to-r from-purple-700 to-blue-700 rounded-xl shadow-lg p-4 text-center">
                <a href="product.html?id=${id}">
                  <img src="${p.image}" alt="${p.name}" class="h-40 w-full object-contain rounded-md mb-3 cursor-pointer" />
                </a>
                <h4 class="font-semibold text-lg mb-1">
                  <a href="product.html?id=${id}" class="hover:underline">${p.name}</a>
                </h4>
                <p class="text-yellow-400 font-bold mb-2">${p.price.toLocaleString()} ل.س</p>
                <a href="https://wa.me/963969237946?text=${encodeURIComponent("مرحبا، أود طلب: " + p.name)}" target="_blank" class="inline-block bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded transition">اطلبها الآن</a>
              </div>
            `;
          });
        });
      });
    }
  </script>

</body>
</html>